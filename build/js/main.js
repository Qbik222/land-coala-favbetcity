"use strict";

var playBtn = document.querySelector('.bonus__main-wheel-btn'),
  main = document.querySelector('.bonus__main'),
  wheel = document.querySelector('.bonus__main-wheel-reel'),
  overlay = document.querySelector('.bonus__overlay'),
  popupFirst = document.querySelector('.bonus__firstWin'),
  overflow = document.querySelector('body'),
  wrapper = document.querySelector('.bonus'),
  bonusStart = document.querySelector('.bonus__start'),
  bonusText = document.querySelector('.bonus__text'),
  audioCoin = document.querySelector('.audio-coins'),
  audioFirework = document.querySelector('.audio-firework'),
  audioMain = document.querySelector('.audio-main'),
  audioWheel = document.querySelector('.audio-wheel'),
  btnVolume = document.querySelector('.bonus__music'),
  btnVolumeImg = document.querySelector('.bonus__music-img'),
  body = document.querySelector('body'),
  allLink = document.querySelector('.all-link'),
  popupText = document.querySelector('.bonus__firstWin-text');
audioMain.volume = 0.35;
audioFirework.volume = 0.6;
audioCoin.volume = 0.6;

// audioMain.volume = 0
// audioFirework.volume = 0
// audioCoin.volume = 0

function scrollToTop() {
  var currentPosition = document.documentElement.scrollTop || document.body.scrollTop;
  if (currentPosition > 0) {
    window.requestAnimationFrame(scrollToTop);
    window.scrollTo(0, currentPosition - currentPosition / 8);
  }
}
btnVolume.addEventListener('click', function () {
  if (btnVolume.classList.contains('off')) {
    btnVolume.classList.remove('off');
    btnVolume.classList.add('on');
    audioMain.play();
    audioFirework.play();
    btnVolumeImg.setAttribute('src', 'img/sound-on.svg');
  } else {
    btnVolume.classList.remove('on');
    btnVolume.classList.add('off');
    audioMain.pause();
    audioMain.currentTime = 0;
    audioFirework.pause();
    audioFirework.currentTime = 0;
    audioWheel.pause();
    audioWheel.currentTime = 0;
    audioCoin.pause();
    audioCoin.currentTime = 0;
    btnVolumeImg.setAttribute('src', 'img/sound-off.svg');
  }
});
setTimeout(function () {
  bonusStart.classList.add('_active');
  main.classList.add('_active');
  setTimeout(function () {
    bonusText.classList.add('_visible');
  }, 1200);
}, 3500);
playBtn.addEventListener('click', function () {
  runFirstRotation();
});
function runFirstRotation() {
  scrollToTop();
  btnVolume.classList.remove('off');
  btnVolume.classList.add('on');
  btnVolumeImg.setAttribute('src', 'img/sound-on.svg');
  audioMain.play();
  audioFirework.play();
  audioWheel.play();
  wheel.classList.add('reel-rotation-first');
  playBtn.classList.remove('pulse-btn');
  playBtn.style.cursor = 'default';
  wrapper.style.pointerEvents = 'none';
  wrapper.style.overflow = 'hidden';
  body.style.overflow = 'hidden';
  setTimeout(function () {
    doAfterFirstRotation();
  }, 6000);
}
function doAfterFirstRotation() {
  popupText.classList.add('_visible');
  allLink.style.display = 'block';
  audioCoin.play();
  wheel.style.transform = 'rotate(1440deg)';
  wheel.classList.remove('reel-rotation-first');
  displayPopup(popupFirst);
  wrapper.style.pointerEvents = 'auto';
  overflow.style.overflow = 'hidden';
}
function displayPopup(popup) {
  overlay.classList.remove('opacity-overlay');
  popup.classList.remove('hide');
}
window.addEventListener('orientationchange', function () {
  window.location.reload();
});
(function () {
  var url = new URL(window.location.href);
  var params = ['l', 'utm_source', 'utm_medium', 'utm_campaign', 'utm_term', 'utm_content', 'param1', 'param2', 'param3', 'param4', 'creative_type', 'creative_id'];
  var linkParams = ['affid', 'cpaid']; // ищем в url redirectUrl в url:

  if (url.searchParams.has('redirectUrl')) {
    var redirectUrl = new URL(url.searchParams.get('redirectUrl'));
    if (redirectUrl.href.match(/\//g).length === 4 && redirectUrl.searchParams.get('l')) {
      //если ссылка в ссылка redirectUrl корректная
      localStorage.setItem('redirectUrl', redirectUrl.href); // указываем точкой входа домен с протоколом из redirectUrl
    }
  }
  params.forEach(function (param) {
    if (url.searchParams.has(param)) localStorage.setItem(param, url.searchParams.get(param));
  });
  linkParams.forEach(function (linkParam) {
    if (url.searchParams.has(linkParam)) localStorage.setItem(linkParam, url.searchParams.get(linkParam));
  });
  window.addEventListener('click', function (e) {
    var link,
      parent = e.target.closest('a');
    if (parent.getAttribute('href') !== 'https://tds.favbet.partners') {
      return;
    }
    if (parent) {
      e.preventDefault();
      var affid = localStorage.getItem('affid');
      var cpaid = localStorage.getItem('cpaid');
      if (localStorage.getItem("redirectUrl")) {
        link = new URL(localStorage.getItem("redirectUrl"));
      } else {
        link = new URL(parent.href);
        if (affid && cpaid) {
          link.pathname = '/' + affid + '/' + cpaid;
        }
      }
      params.forEach(function (param) {
        if (url.searchParams.has(param)) {
          link.searchParams.set(param, localStorage.getItem(param));
        }
      });
      document.location.href = link;
    }
  });
})();
"use strict";
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiLCJzZWNvbmQuanMiXSwibmFtZXMiOlsicGxheUJ0biIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsIm1haW4iLCJ3aGVlbCIsIm92ZXJsYXkiLCJwb3B1cEZpcnN0Iiwib3ZlcmZsb3ciLCJ3cmFwcGVyIiwiYm9udXNTdGFydCIsImJvbnVzVGV4dCIsImF1ZGlvQ29pbiIsImF1ZGlvRmlyZXdvcmsiLCJhdWRpb01haW4iLCJhdWRpb1doZWVsIiwiYnRuVm9sdW1lIiwiYnRuVm9sdW1lSW1nIiwiYm9keSIsImFsbExpbmsiLCJwb3B1cFRleHQiLCJ2b2x1bWUiLCJzY3JvbGxUb1RvcCIsImN1cnJlbnRQb3NpdGlvbiIsImRvY3VtZW50RWxlbWVudCIsInNjcm9sbFRvcCIsIndpbmRvdyIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsInNjcm9sbFRvIiwiYWRkRXZlbnRMaXN0ZW5lciIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwicmVtb3ZlIiwiYWRkIiwicGxheSIsInNldEF0dHJpYnV0ZSIsInBhdXNlIiwiY3VycmVudFRpbWUiLCJzZXRUaW1lb3V0IiwicnVuRmlyc3RSb3RhdGlvbiIsInN0eWxlIiwiY3Vyc29yIiwicG9pbnRlckV2ZW50cyIsImRvQWZ0ZXJGaXJzdFJvdGF0aW9uIiwiZGlzcGxheSIsInRyYW5zZm9ybSIsImRpc3BsYXlQb3B1cCIsInBvcHVwIiwibG9jYXRpb24iLCJyZWxvYWQiLCJ1cmwiLCJVUkwiLCJocmVmIiwicGFyYW1zIiwibGlua1BhcmFtcyIsInNlYXJjaFBhcmFtcyIsImhhcyIsInJlZGlyZWN0VXJsIiwiZ2V0IiwibWF0Y2giLCJsZW5ndGgiLCJsb2NhbFN0b3JhZ2UiLCJzZXRJdGVtIiwiZm9yRWFjaCIsInBhcmFtIiwibGlua1BhcmFtIiwiZSIsImxpbmsiLCJwYXJlbnQiLCJ0YXJnZXQiLCJjbG9zZXN0IiwiZ2V0QXR0cmlidXRlIiwicHJldmVudERlZmF1bHQiLCJhZmZpZCIsImdldEl0ZW0iLCJjcGFpZCIsInBhdGhuYW1lIiwic2V0Il0sIm1hcHBpbmdzIjoiOztBQUNBLElBQU1BLE9BQU8sR0FBR0MsUUFBUSxDQUFDQyxhQUFhLENBQUMsd0JBQXdCLENBQUM7RUFDMURDLElBQUksR0FBR0YsUUFBUSxDQUFDQyxhQUFhLENBQUMsY0FBYyxDQUFDO0VBQzdDRSxLQUFLLEdBQUdILFFBQVEsQ0FBQ0MsYUFBYSxDQUFDLHlCQUF5QixDQUFDO0VBQ3pERyxPQUFPLEdBQUdKLFFBQVEsQ0FBQ0MsYUFBYSxDQUFDLGlCQUFpQixDQUFDO0VBQ25ESSxVQUFVLEdBQUdMLFFBQVEsQ0FBQ0MsYUFBYSxDQUFDLGtCQUFrQixDQUFDO0VBQ3ZESyxRQUFRLEdBQUdOLFFBQVEsQ0FBQ0MsYUFBYSxDQUFDLE1BQU0sQ0FBQztFQUN6Q00sT0FBTyxHQUFHUCxRQUFRLENBQUNDLGFBQWEsQ0FBQyxRQUFRLENBQUM7RUFDMUNPLFVBQVUsR0FBR1IsUUFBUSxDQUFDQyxhQUFhLENBQUMsZUFBZSxDQUFDO0VBQ3BEUSxTQUFTLEdBQUdULFFBQVEsQ0FBQ0MsYUFBYSxDQUFDLGNBQWMsQ0FBQztFQUNsRFMsU0FBUyxHQUFHVixRQUFRLENBQUNDLGFBQWEsQ0FBQyxjQUFjLENBQUM7RUFDbERVLGFBQWEsR0FBR1gsUUFBUSxDQUFDQyxhQUFhLENBQUMsaUJBQWlCLENBQUM7RUFDekRXLFNBQVMsR0FBR1osUUFBUSxDQUFDQyxhQUFhLENBQUMsYUFBYSxDQUFDO0VBQ2pEWSxVQUFVLEdBQUdiLFFBQVEsQ0FBQ0MsYUFBYSxDQUFDLGNBQWMsQ0FBQztFQUNuRGEsU0FBUyxHQUFHZCxRQUFRLENBQUNDLGFBQWEsQ0FBQyxlQUFlLENBQUM7RUFDbkRjLFlBQVksR0FBR2YsUUFBUSxDQUFDQyxhQUFhLENBQUMsbUJBQW1CLENBQUM7RUFDMURlLElBQUksR0FBR2hCLFFBQVEsQ0FBQ0MsYUFBYSxDQUFDLE1BQU0sQ0FBQztFQUNyQ2dCLE9BQU8sR0FBR2pCLFFBQVEsQ0FBQ0MsYUFBYSxDQUFDLFdBQVcsQ0FBQztFQUM3Q2lCLFNBQVMsR0FBR2xCLFFBQVEsQ0FBQ0MsYUFBYSxDQUFDLHVCQUF1QixDQUFDO0FBRWpFVyxTQUFTLENBQUNPLE1BQU0sR0FBRyxJQUFJO0FBQ3ZCUixhQUFhLENBQUNRLE1BQU0sR0FBRyxHQUFHO0FBQzFCVCxTQUFTLENBQUNTLE1BQU0sR0FBRyxHQUFHOztBQUV0QjtBQUNBO0FBQ0E7O0FBRUEsU0FBU0MsV0FBV0EsQ0FBQSxFQUFHO0VBQ25CLElBQU1DLGVBQWUsR0FBR3JCLFFBQVEsQ0FBQ3NCLGVBQWUsQ0FBQ0MsU0FBUyxJQUFJdkIsUUFBUSxDQUFDZ0IsSUFBSSxDQUFDTyxTQUFTO0VBQ3JGLElBQUlGLGVBQWUsR0FBRyxDQUFDLEVBQUU7SUFDckJHLE1BQU0sQ0FBQ0MscUJBQXFCLENBQUNMLFdBQVcsQ0FBQztJQUN6Q0ksTUFBTSxDQUFDRSxRQUFRLENBQUMsQ0FBQyxFQUFFTCxlQUFlLEdBQUdBLGVBQWUsR0FBRyxDQUFDLENBQUM7RUFDN0Q7QUFDSjtBQUVBUCxTQUFTLENBQUNhLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxZQUFNO0VBQ3RDLElBQUdiLFNBQVMsQ0FBQ2MsU0FBUyxDQUFDQyxRQUFRLENBQUMsS0FBSyxDQUFDLEVBQUM7SUFDbkNmLFNBQVMsQ0FBQ2MsU0FBUyxDQUFDRSxNQUFNLENBQUMsS0FBSyxDQUFDO0lBQ2pDaEIsU0FBUyxDQUFDYyxTQUFTLENBQUNHLEdBQUcsQ0FBQyxJQUFJLENBQUM7SUFDN0JuQixTQUFTLENBQUNvQixJQUFJLENBQUMsQ0FBQztJQUNoQnJCLGFBQWEsQ0FBQ3FCLElBQUksQ0FBQyxDQUFDO0lBQ3BCakIsWUFBWSxDQUFDa0IsWUFBWSxDQUFDLEtBQUssRUFBRSxrQkFBa0IsQ0FBQztFQUV4RCxDQUFDLE1BQU07SUFDSG5CLFNBQVMsQ0FBQ2MsU0FBUyxDQUFDRSxNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ2hDaEIsU0FBUyxDQUFDYyxTQUFTLENBQUNHLEdBQUcsQ0FBQyxLQUFLLENBQUM7SUFDOUJuQixTQUFTLENBQUNzQixLQUFLLENBQUMsQ0FBQztJQUNqQnRCLFNBQVMsQ0FBQ3VCLFdBQVcsR0FBRyxDQUFDO0lBQ3pCeEIsYUFBYSxDQUFDdUIsS0FBSyxDQUFDLENBQUM7SUFDckJ2QixhQUFhLENBQUN3QixXQUFXLEdBQUcsQ0FBQztJQUM3QnRCLFVBQVUsQ0FBQ3FCLEtBQUssQ0FBQyxDQUFDO0lBQ2xCckIsVUFBVSxDQUFDc0IsV0FBVyxHQUFHLENBQUM7SUFDMUJ6QixTQUFTLENBQUN3QixLQUFLLENBQUMsQ0FBQztJQUNqQnhCLFNBQVMsQ0FBQ3lCLFdBQVcsR0FBRyxDQUFDO0lBQ3pCcEIsWUFBWSxDQUFDa0IsWUFBWSxDQUFDLEtBQUssRUFBRSxtQkFBbUIsQ0FBQztFQUN6RDtBQUNKLENBQUMsQ0FBQztBQUVGRyxVQUFVLENBQUMsWUFBVztFQUNsQjVCLFVBQVUsQ0FBQ29CLFNBQVMsQ0FBQ0csR0FBRyxDQUFDLFNBQVMsQ0FBQztFQUNuQzdCLElBQUksQ0FBQzBCLFNBQVMsQ0FBQ0csR0FBRyxDQUFDLFNBQVMsQ0FBQztFQUM3QkssVUFBVSxDQUFDLFlBQVc7SUFDbEIzQixTQUFTLENBQUNtQixTQUFTLENBQUNHLEdBQUcsQ0FBQyxVQUFVLENBQUM7RUFDdkMsQ0FBQyxFQUFFLElBQUksQ0FBQztBQUVaLENBQUMsRUFBRSxJQUFJLENBQUM7QUFHUmhDLE9BQU8sQ0FBQzRCLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxZQUFNO0VBQ3BDVSxnQkFBZ0IsQ0FBQyxDQUFDO0FBQ3RCLENBQUMsQ0FBQztBQUVGLFNBQVNBLGdCQUFnQkEsQ0FBQSxFQUFHO0VBQ3hCakIsV0FBVyxDQUFDLENBQUM7RUFDYk4sU0FBUyxDQUFDYyxTQUFTLENBQUNFLE1BQU0sQ0FBQyxLQUFLLENBQUM7RUFDakNoQixTQUFTLENBQUNjLFNBQVMsQ0FBQ0csR0FBRyxDQUFDLElBQUksQ0FBQztFQUM3QmhCLFlBQVksQ0FBQ2tCLFlBQVksQ0FBQyxLQUFLLEVBQUUsa0JBQWtCLENBQUM7RUFDcERyQixTQUFTLENBQUNvQixJQUFJLENBQUMsQ0FBQztFQUNoQnJCLGFBQWEsQ0FBQ3FCLElBQUksQ0FBQyxDQUFDO0VBQ3BCbkIsVUFBVSxDQUFDbUIsSUFBSSxDQUFDLENBQUM7RUFDakI3QixLQUFLLENBQUN5QixTQUFTLENBQUNHLEdBQUcsQ0FBQyxxQkFBcUIsQ0FBQztFQUMxQ2hDLE9BQU8sQ0FBQzZCLFNBQVMsQ0FBQ0UsTUFBTSxDQUFDLFdBQVcsQ0FBQztFQUNyQy9CLE9BQU8sQ0FBQ3VDLEtBQUssQ0FBQ0MsTUFBTSxHQUFHLFNBQVM7RUFDaENoQyxPQUFPLENBQUMrQixLQUFLLENBQUNFLGFBQWEsR0FBRyxNQUFNO0VBQ3BDakMsT0FBTyxDQUFDK0IsS0FBSyxDQUFDaEMsUUFBUSxHQUFHLFFBQVE7RUFDakNVLElBQUksQ0FBQ3NCLEtBQUssQ0FBQ2hDLFFBQVEsR0FBRyxRQUFRO0VBQzlCOEIsVUFBVSxDQUFDLFlBQU07SUFDYkssb0JBQW9CLENBQUMsQ0FBQztFQUMxQixDQUFDLEVBQUUsSUFBSSxDQUFDO0FBQ1o7QUFFQSxTQUFTQSxvQkFBb0JBLENBQUEsRUFBRztFQUM1QnZCLFNBQVMsQ0FBQ1UsU0FBUyxDQUFDRyxHQUFHLENBQUMsVUFBVSxDQUFDO0VBQ25DZCxPQUFPLENBQUNxQixLQUFLLENBQUNJLE9BQU8sR0FBRyxPQUFPO0VBQy9CaEMsU0FBUyxDQUFDc0IsSUFBSSxDQUFDLENBQUM7RUFDaEI3QixLQUFLLENBQUNtQyxLQUFLLENBQUNLLFNBQVMsR0FBRyxpQkFBaUI7RUFDekN4QyxLQUFLLENBQUN5QixTQUFTLENBQUNFLE1BQU0sQ0FBQyxxQkFBcUIsQ0FBQztFQUM3Q2MsWUFBWSxDQUFDdkMsVUFBVSxDQUFDO0VBQ3hCRSxPQUFPLENBQUMrQixLQUFLLENBQUNFLGFBQWEsR0FBRyxNQUFNO0VBQ3BDbEMsUUFBUSxDQUFDZ0MsS0FBSyxDQUFDaEMsUUFBUSxHQUFHLFFBQVE7QUFDdEM7QUFHQSxTQUFTc0MsWUFBWUEsQ0FBQ0MsS0FBSyxFQUFFO0VBQ3pCekMsT0FBTyxDQUFDd0IsU0FBUyxDQUFDRSxNQUFNLENBQUMsaUJBQWlCLENBQUM7RUFDM0NlLEtBQUssQ0FBQ2pCLFNBQVMsQ0FBQ0UsTUFBTSxDQUFDLE1BQU0sQ0FBQztBQUNsQztBQUVBTixNQUFNLENBQUNHLGdCQUFnQixDQUFDLG1CQUFtQixFQUFFLFlBQU07RUFDL0NILE1BQU0sQ0FBQ3NCLFFBQVEsQ0FBQ0MsTUFBTSxDQUFDLENBQUM7QUFDNUIsQ0FBQyxDQUFDO0FBSUYsQ0FBQyxZQUFZO0VBQ1QsSUFBSUMsR0FBRyxHQUFHLElBQUlDLEdBQUcsQ0FBQ3pCLE1BQU0sQ0FBQ3NCLFFBQVEsQ0FBQ0ksSUFBSSxDQUFDO0VBQ3ZDLElBQUlDLE1BQU0sR0FBRyxDQUFDLEdBQUcsRUFBRSxZQUFZLEVBQUUsWUFBWSxFQUFFLGNBQWMsRUFBRSxVQUFVLEVBQUUsYUFBYSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxlQUFlLEVBQUUsYUFBYSxDQUFDO0VBQ2pLLElBQUlDLFVBQVUsR0FBRyxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDOztFQUVyQyxJQUFJSixHQUFHLENBQUNLLFlBQVksQ0FBQ0MsR0FBRyxDQUFDLGFBQWEsQ0FBQyxFQUFFO0lBQ3JDLElBQUlDLFdBQVcsR0FBRyxJQUFJTixHQUFHLENBQUNELEdBQUcsQ0FBQ0ssWUFBWSxDQUFDRyxHQUFHLENBQUMsYUFBYSxDQUFDLENBQUM7SUFFOUQsSUFBSUQsV0FBVyxDQUFDTCxJQUFJLENBQUNPLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQ0MsTUFBTSxLQUFLLENBQUMsSUFBSUgsV0FBVyxDQUFDRixZQUFZLENBQUNHLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRTtNQUNqRjtNQUNBRyxZQUFZLENBQUNDLE9BQU8sQ0FBQyxhQUFhLEVBQUVMLFdBQVcsQ0FBQ0wsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUMzRDtFQUNKO0VBRUFDLE1BQU0sQ0FBQ1UsT0FBTyxDQUFDLFVBQVVDLEtBQUssRUFBRTtJQUM1QixJQUFJZCxHQUFHLENBQUNLLFlBQVksQ0FBQ0MsR0FBRyxDQUFDUSxLQUFLLENBQUMsRUFBRUgsWUFBWSxDQUFDQyxPQUFPLENBQUNFLEtBQUssRUFBRWQsR0FBRyxDQUFDSyxZQUFZLENBQUNHLEdBQUcsQ0FBQ00sS0FBSyxDQUFDLENBQUM7RUFDN0YsQ0FBQyxDQUFDO0VBRUZWLFVBQVUsQ0FBQ1MsT0FBTyxDQUFDLFVBQVVFLFNBQVMsRUFBRTtJQUNwQyxJQUFJZixHQUFHLENBQUNLLFlBQVksQ0FBQ0MsR0FBRyxDQUFDUyxTQUFTLENBQUMsRUFBRUosWUFBWSxDQUFDQyxPQUFPLENBQUNHLFNBQVMsRUFBRWYsR0FBRyxDQUFDSyxZQUFZLENBQUNHLEdBQUcsQ0FBQ08sU0FBUyxDQUFDLENBQUM7RUFDekcsQ0FBQyxDQUFDO0VBRUZ2QyxNQUFNLENBQUNHLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxVQUFVcUMsQ0FBQyxFQUFFO0lBQzFDLElBQUlDLElBQUk7TUFDSkMsTUFBTSxHQUFHRixDQUFDLENBQUNHLE1BQU0sQ0FBQ0MsT0FBTyxDQUFDLEdBQUcsQ0FBQztJQUVsQyxJQUFJRixNQUFNLENBQUNHLFlBQVksQ0FBQyxNQUFNLENBQUMsS0FBSyw2QkFBNkIsRUFBRTtNQUMvRDtJQUNKO0lBRUEsSUFBSUgsTUFBTSxFQUFFO01BQ1JGLENBQUMsQ0FBQ00sY0FBYyxDQUFDLENBQUM7TUFDbEIsSUFBSUMsS0FBSyxHQUFHWixZQUFZLENBQUNhLE9BQU8sQ0FBQyxPQUFPLENBQUM7TUFDekMsSUFBSUMsS0FBSyxHQUFHZCxZQUFZLENBQUNhLE9BQU8sQ0FBQyxPQUFPLENBQUM7TUFFekMsSUFBSWIsWUFBWSxDQUFDYSxPQUFPLENBQUMsYUFBYSxDQUFDLEVBQUU7UUFDckNQLElBQUksR0FBRyxJQUFJaEIsR0FBRyxDQUFDVSxZQUFZLENBQUNhLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQztNQUN2RCxDQUFDLE1BQU07UUFDSFAsSUFBSSxHQUFHLElBQUloQixHQUFHLENBQUNpQixNQUFNLENBQUNoQixJQUFJLENBQUM7UUFDM0IsSUFBSXFCLEtBQUssSUFBSUUsS0FBSyxFQUFFO1VBQ2hCUixJQUFJLENBQUNTLFFBQVEsR0FBRyxHQUFHLEdBQUdILEtBQUssR0FBRyxHQUFHLEdBQUdFLEtBQUs7UUFDN0M7TUFDSjtNQUVBdEIsTUFBTSxDQUFDVSxPQUFPLENBQUMsVUFBVUMsS0FBSyxFQUFFO1FBQzVCLElBQUlkLEdBQUcsQ0FBQ0ssWUFBWSxDQUFDQyxHQUFHLENBQUNRLEtBQUssQ0FBQyxFQUFFO1VBQzdCRyxJQUFJLENBQUNaLFlBQVksQ0FBQ3NCLEdBQUcsQ0FBQ2IsS0FBSyxFQUFFSCxZQUFZLENBQUNhLE9BQU8sQ0FBQ1YsS0FBSyxDQUFDLENBQUM7UUFDN0Q7TUFDSixDQUFDLENBQUM7TUFFRjlELFFBQVEsQ0FBQzhDLFFBQVEsQ0FBQ0ksSUFBSSxHQUFHZSxJQUFJO0lBQ2pDO0VBQ0osQ0FBQyxDQUFDO0FBQ04sQ0FBQyxFQUFFLENBQUM7QUN4S0oiLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIlxuY29uc3QgcGxheUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ib251c19fbWFpbi13aGVlbC1idG4nKSxcbiAgICAgIG1haW4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYm9udXNfX21haW4nKSxcbiAgICAgIHdoZWVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJvbnVzX19tYWluLXdoZWVsLXJlZWwnKSxcbiAgICAgIG92ZXJsYXkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYm9udXNfX292ZXJsYXknKSxcbiAgICAgIHBvcHVwRmlyc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYm9udXNfX2ZpcnN0V2luJyksXG4gICAgICBvdmVyZmxvdyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKSxcbiAgICAgIHdyYXBwZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYm9udXMnKSxcbiAgICAgIGJvbnVzU3RhcnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYm9udXNfX3N0YXJ0JyksXG4gICAgICBib251c1RleHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYm9udXNfX3RleHQnKSxcbiAgICAgIGF1ZGlvQ29pbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hdWRpby1jb2lucycpLFxuICAgICAgYXVkaW9GaXJld29yayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hdWRpby1maXJld29yaycpLFxuICAgICAgYXVkaW9NYWluID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmF1ZGlvLW1haW4nKSxcbiAgICAgIGF1ZGlvV2hlZWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYXVkaW8td2hlZWwnKSxcbiAgICAgIGJ0blZvbHVtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ib251c19fbXVzaWMnKSxcbiAgICAgIGJ0blZvbHVtZUltZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ib251c19fbXVzaWMtaW1nJyksXG4gICAgICBib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpLFxuICAgICAgYWxsTGluayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hbGwtbGluaycpLFxuICAgICAgcG9wdXBUZXh0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJvbnVzX19maXJzdFdpbi10ZXh0JylcblxuYXVkaW9NYWluLnZvbHVtZSA9IDAuMzVcbmF1ZGlvRmlyZXdvcmsudm9sdW1lID0gMC42XG5hdWRpb0NvaW4udm9sdW1lID0gMC42XG5cbi8vIGF1ZGlvTWFpbi52b2x1bWUgPSAwXG4vLyBhdWRpb0ZpcmV3b3JrLnZvbHVtZSA9IDBcbi8vIGF1ZGlvQ29pbi52b2x1bWUgPSAwXG5cbmZ1bmN0aW9uIHNjcm9sbFRvVG9wKCkge1xuICAgIGNvbnN0IGN1cnJlbnRQb3NpdGlvbiA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AgfHwgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3A7XG4gICAgaWYgKGN1cnJlbnRQb3NpdGlvbiA+IDApIHtcbiAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShzY3JvbGxUb1RvcCk7XG4gICAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCBjdXJyZW50UG9zaXRpb24gLSBjdXJyZW50UG9zaXRpb24gLyA4KTtcbiAgICB9XG59XG5cbmJ0blZvbHVtZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICBpZihidG5Wb2x1bWUuY2xhc3NMaXN0LmNvbnRhaW5zKCdvZmYnKSl7XG4gICAgICAgIGJ0blZvbHVtZS5jbGFzc0xpc3QucmVtb3ZlKCdvZmYnKVxuICAgICAgICBidG5Wb2x1bWUuY2xhc3NMaXN0LmFkZCgnb24nKVxuICAgICAgICBhdWRpb01haW4ucGxheSgpXG4gICAgICAgIGF1ZGlvRmlyZXdvcmsucGxheSgpXG4gICAgICAgIGJ0blZvbHVtZUltZy5zZXRBdHRyaWJ1dGUoJ3NyYycsICdpbWcvc291bmQtb24uc3ZnJylcblxuICAgIH0gZWxzZSB7XG4gICAgICAgIGJ0blZvbHVtZS5jbGFzc0xpc3QucmVtb3ZlKCdvbicpXG4gICAgICAgIGJ0blZvbHVtZS5jbGFzc0xpc3QuYWRkKCdvZmYnKVxuICAgICAgICBhdWRpb01haW4ucGF1c2UoKVxuICAgICAgICBhdWRpb01haW4uY3VycmVudFRpbWUgPSAwO1xuICAgICAgICBhdWRpb0ZpcmV3b3JrLnBhdXNlKClcbiAgICAgICAgYXVkaW9GaXJld29yay5jdXJyZW50VGltZSA9IDA7XG4gICAgICAgIGF1ZGlvV2hlZWwucGF1c2UoKVxuICAgICAgICBhdWRpb1doZWVsLmN1cnJlbnRUaW1lID0gMDtcbiAgICAgICAgYXVkaW9Db2luLnBhdXNlKClcbiAgICAgICAgYXVkaW9Db2luLmN1cnJlbnRUaW1lID0gMDtcbiAgICAgICAgYnRuVm9sdW1lSW1nLnNldEF0dHJpYnV0ZSgnc3JjJywgJ2ltZy9zb3VuZC1vZmYuc3ZnJylcbiAgICB9XG59KVxuXG5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpe1xuICAgIGJvbnVzU3RhcnQuY2xhc3NMaXN0LmFkZCgnX2FjdGl2ZScpXG4gICAgbWFpbi5jbGFzc0xpc3QuYWRkKCdfYWN0aXZlJylcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpe1xuICAgICAgICBib251c1RleHQuY2xhc3NMaXN0LmFkZCgnX3Zpc2libGUnKVxuICAgIH0sIDEyMDApXG5cbn0sIDM1MDApO1xuXG5cbnBsYXlCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgcnVuRmlyc3RSb3RhdGlvbigpXG59KVxuXG5mdW5jdGlvbiBydW5GaXJzdFJvdGF0aW9uKCkge1xuICAgIHNjcm9sbFRvVG9wKClcbiAgICBidG5Wb2x1bWUuY2xhc3NMaXN0LnJlbW92ZSgnb2ZmJylcbiAgICBidG5Wb2x1bWUuY2xhc3NMaXN0LmFkZCgnb24nKVxuICAgIGJ0blZvbHVtZUltZy5zZXRBdHRyaWJ1dGUoJ3NyYycsICdpbWcvc291bmQtb24uc3ZnJylcbiAgICBhdWRpb01haW4ucGxheSgpXG4gICAgYXVkaW9GaXJld29yay5wbGF5KClcbiAgICBhdWRpb1doZWVsLnBsYXkoKVxuICAgIHdoZWVsLmNsYXNzTGlzdC5hZGQoJ3JlZWwtcm90YXRpb24tZmlyc3QnKVxuICAgIHBsYXlCdG4uY2xhc3NMaXN0LnJlbW92ZSgncHVsc2UtYnRuJylcbiAgICBwbGF5QnRuLnN0eWxlLmN1cnNvciA9ICdkZWZhdWx0J1xuICAgIHdyYXBwZXIuc3R5bGUucG9pbnRlckV2ZW50cyA9ICdub25lJ1xuICAgIHdyYXBwZXIuc3R5bGUub3ZlcmZsb3cgPSAnaGlkZGVuJ1xuICAgIGJvZHkuc3R5bGUub3ZlcmZsb3cgPSAnaGlkZGVuJ1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBkb0FmdGVyRmlyc3RSb3RhdGlvbigpXG4gICAgfSwgNjAwMClcbn1cblxuZnVuY3Rpb24gZG9BZnRlckZpcnN0Um90YXRpb24oKSB7XG4gICAgcG9wdXBUZXh0LmNsYXNzTGlzdC5hZGQoJ192aXNpYmxlJylcbiAgICBhbGxMaW5rLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snXG4gICAgYXVkaW9Db2luLnBsYXkoKVxuICAgIHdoZWVsLnN0eWxlLnRyYW5zZm9ybSA9ICdyb3RhdGUoMTQ0MGRlZyknXG4gICAgd2hlZWwuY2xhc3NMaXN0LnJlbW92ZSgncmVlbC1yb3RhdGlvbi1maXJzdCcpXG4gICAgZGlzcGxheVBvcHVwKHBvcHVwRmlyc3QpXG4gICAgd3JhcHBlci5zdHlsZS5wb2ludGVyRXZlbnRzID0gJ2F1dG8nXG4gICAgb3ZlcmZsb3cuc3R5bGUub3ZlcmZsb3cgPSAnaGlkZGVuJ1xufVxuXG5cbmZ1bmN0aW9uIGRpc3BsYXlQb3B1cChwb3B1cCkge1xuICAgIG92ZXJsYXkuY2xhc3NMaXN0LnJlbW92ZSgnb3BhY2l0eS1vdmVybGF5JylcbiAgICBwb3B1cC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJylcbn1cblxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ29yaWVudGF0aW9uY2hhbmdlJywgKCkgPT4ge1xuICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKVxufSk7XG5cblxuXG4oZnVuY3Rpb24gKCkge1xuICAgIHZhciB1cmwgPSBuZXcgVVJMKHdpbmRvdy5sb2NhdGlvbi5ocmVmKTtcbiAgICB2YXIgcGFyYW1zID0gWydsJywgJ3V0bV9zb3VyY2UnLCAndXRtX21lZGl1bScsICd1dG1fY2FtcGFpZ24nLCAndXRtX3Rlcm0nLCAndXRtX2NvbnRlbnQnLCAncGFyYW0xJywgJ3BhcmFtMicsICdwYXJhbTMnLCAncGFyYW00JywgJ2NyZWF0aXZlX3R5cGUnLCAnY3JlYXRpdmVfaWQnXTtcbiAgICB2YXIgbGlua1BhcmFtcyA9IFsnYWZmaWQnLCAnY3BhaWQnXTsgLy8g0LjRidC10Lwg0LIgdXJsIHJlZGlyZWN0VXJsINCyIHVybDpcblxuICAgIGlmICh1cmwuc2VhcmNoUGFyYW1zLmhhcygncmVkaXJlY3RVcmwnKSkge1xuICAgICAgICB2YXIgcmVkaXJlY3RVcmwgPSBuZXcgVVJMKHVybC5zZWFyY2hQYXJhbXMuZ2V0KCdyZWRpcmVjdFVybCcpKTtcblxuICAgICAgICBpZiAocmVkaXJlY3RVcmwuaHJlZi5tYXRjaCgvXFwvL2cpLmxlbmd0aCA9PT0gNCAmJiByZWRpcmVjdFVybC5zZWFyY2hQYXJhbXMuZ2V0KCdsJykpIHtcbiAgICAgICAgICAgIC8v0LXRgdC70Lgg0YHRgdGL0LvQutCwINCyINGB0YHRi9C70LrQsCByZWRpcmVjdFVybCDQutC+0YDRgNC10LrRgtC90LDRj1xuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3JlZGlyZWN0VXJsJywgcmVkaXJlY3RVcmwuaHJlZik7IC8vINGD0LrQsNC30YvQstCw0LXQvCDRgtC+0YfQutC+0Lkg0LLRhdC+0LTQsCDQtNC+0LzQtdC9INGBINC/0YDQvtGC0L7QutC+0LvQvtC8INC40LcgcmVkaXJlY3RVcmxcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHBhcmFtcy5mb3JFYWNoKGZ1bmN0aW9uIChwYXJhbSkge1xuICAgICAgICBpZiAodXJsLnNlYXJjaFBhcmFtcy5oYXMocGFyYW0pKSBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShwYXJhbSwgdXJsLnNlYXJjaFBhcmFtcy5nZXQocGFyYW0pKTtcbiAgICB9KTtcblxuICAgIGxpbmtQYXJhbXMuZm9yRWFjaChmdW5jdGlvbiAobGlua1BhcmFtKSB7XG4gICAgICAgIGlmICh1cmwuc2VhcmNoUGFyYW1zLmhhcyhsaW5rUGFyYW0pKSBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShsaW5rUGFyYW0sIHVybC5zZWFyY2hQYXJhbXMuZ2V0KGxpbmtQYXJhbSkpO1xuICAgIH0pO1xuXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdmFyIGxpbmssXG4gICAgICAgICAgICBwYXJlbnQgPSBlLnRhcmdldC5jbG9zZXN0KCdhJyk7XG5cbiAgICAgICAgaWYgKHBhcmVudC5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSAhPT0gJ2h0dHBzOi8vdGRzLmZhdmJldC5wYXJ0bmVycycpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwYXJlbnQpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHZhciBhZmZpZCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdhZmZpZCcpO1xuICAgICAgICAgICAgdmFyIGNwYWlkID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2NwYWlkJyk7XG5cbiAgICAgICAgICAgIGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInJlZGlyZWN0VXJsXCIpKSB7XG4gICAgICAgICAgICAgICAgbGluayA9IG5ldyBVUkwobG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJyZWRpcmVjdFVybFwiKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGxpbmsgPSBuZXcgVVJMKHBhcmVudC5ocmVmKTtcbiAgICAgICAgICAgICAgICBpZiAoYWZmaWQgJiYgY3BhaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgbGluay5wYXRobmFtZSA9ICcvJyArIGFmZmlkICsgJy8nICsgY3BhaWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBwYXJhbXMuZm9yRWFjaChmdW5jdGlvbiAocGFyYW0pIHtcbiAgICAgICAgICAgICAgICBpZiAodXJsLnNlYXJjaFBhcmFtcy5oYXMocGFyYW0pKSB7XG4gICAgICAgICAgICAgICAgICAgIGxpbmsuc2VhcmNoUGFyYW1zLnNldChwYXJhbSwgbG9jYWxTdG9yYWdlLmdldEl0ZW0ocGFyYW0pKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZG9jdW1lbnQubG9jYXRpb24uaHJlZiA9IGxpbms7XG4gICAgICAgIH1cbiAgICB9KTtcbn0pKCk7XG5cblxuIiwiIl19
